<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Yeah mr krabs</title>
  </head>
<body>
<button onclick="get_tab()">Show PRODUCTS</button>
<hr/>
<br/>
<div style="height:500px;width:70%; overflow : auto;;" id="out_pulp"></div>
<hr/>
<label>
    <input name="newPulpitData" id="id" type="number" placeholder="Id">
</label>
<br/>
<br/>
<section id="errors" style="color: red; font-size: 20px;"></section>
<button id="close-error" style="display: none;" onclick="closeError()">Close</button>

<script>
    let but;
    let end = 1000, st = 0;
    let order = 'byName';

    function NPage()
    {
      st+=1000; end+=1000;
      get_tab();
    }

    function PrPage(e)
    {
      if((st-1000)<0 || (end-1000)<=0  || (end-1000)<=st) //Problem in there
      {st=st; end=end;}
      else
        st-=1000; end-=1000;
      get_tab();
    }

    function TagOrder(elem)
    {
      order=elem.id;
      get_tab();
    }

    const prodLINK = 'http://localhost:3000/api/prod';
    async function get_tab()
    {
      let container = document.getElementById('out_pulp');
      container.innerHTML = '';
      let load = document.createElement('div');
      load.innerHTML = `<span> LOADING... </span>`;
      container.append(load, document.createElement('br'));

      let LINK = `${prodLINK}/${end}/${st}/${order}`;

      fetch(LINK).then(res => res.json()).then(res =>
      {
        checkErrors(res);
        let container = document.getElementById('out_pulp');
        container.innerHTML = '';

        let table = document.createElement('table');
        table.setAttribute('border', 1);
        table.innerHTML = `<tr>
                              <td id="byBar" onClick="TagOrder(this)">BarCode</td>
                              <td id="byName" onClick="TagOrder(this)">Name</td>
                              <td id="byType" onClick="TagOrder(this)">Type</td>
                              <td>Department</td>
                              <td>Purchase Price</td>
                              <td>Sell Price</td>
                              <td>Weight</td>
                              <td>Volume</td>
                           </tr>`;

        res.forEach(prod =>
        {
          load.remove();
          let pulp = document.createElement('tr');
          pulp.innerHTML = `<td>${prod.Prod_Id}</td><td>${prod.Prod_Name}</td><td>${prod.Prod_Type}</td><td>${prod.Depart}</td><td>${prod.Price_Purchase}</td><td>${prod.Price_Sell}</td><td>${prod.Weight}</td><td>${prod.Volume}</td>`;
          table.append(pulp);
        });
        container.append(table);
        but = document.createElement('div');
        but.innerHTML = `<button onclick="PrPage()">Previos</button><button onclick="NPage()">Next</button>`;
        container.append(but, document.createElement('br'));
      });
      if(n>1)
        but.remove();
    }


    function checkErrors(res)
    {
      if (res.error)
      {
        document.getElementById('errors').innerText = res.error;
        document.getElementById('close-error').style.display = 'block';
      }
    }
    function closeError()
    {
      document.getElementById('errors').innerText = '';
      document.getElementById('close-error').style.display = 'none';
    }
</script>
</body>
</html>
